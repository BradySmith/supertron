<!DOCTYPE html>
<html>

	<head>
		<title>SuperTron</title>
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
		<link rel="stylesheet" type="text/css" href="public/styles.css">
	</head>

	<body>
		<div id="master">
			<div id="gameBoard">
				<canvas id="myCanvas" width="800" height="500" style="border:1px solid #c3c3c3;">
					Your browser does not support the HTML5 canvas tag.
				</canvas>
			</div>
			<div id="content">
				<h2><u>Players</u></h2>
				<ul id="playerList">
				</ul>
				<h2><u>Connected Users</u></h2>
				<ul id="userList">
				</ul>
			</div>
		</div>

		<script src="/socket.io/socket.io.js"></script>
		<script>
			
			var c=document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			var myOffset;
			ctx.fillStyle="#FF0000";

			var socket = io.connect('10.227.163.211');

			socket.on("connected", function(data) {
				$("#userList").empty();
				var connectedUsers = data.connectedUsers;
				connectedUsers.forEach(function (player) {
			  	    $("#userList").append("<li style='color:"+player.color+"'><p>" + player.nickname + "</p></li>");
		  		})
			});

			socket.on("disconnected", function(data) {
				$("#userList").empty();
				var connectedUsers = data.connectedUsers;
				connectedUsers.forEach(function (player) {
			  	    $("#userList").append("<li style='color:"+player.color+"'><p>"+player.nickname+"</p></li>");
		  		})
			});

		  socket.on("update", function(data) {
		  	ctx.clearRect(0,0,800,500);
		  	ctx.font = "10px Arial";
		  	var players = data.currentPlayers;
		  	$("#playerList").empty();
		  	players.forEach(function (player) {
		  	    ctx.fillStyle = player.color;
		  	    ctx.fillRect(player.x, player.y, 10, 10);
		  	    $("#playerList").append("<li style='color:"+player.color+"'><p>" + player.nickname + "</p></li>");
		  	})
		  });
		  
		  window.addEventListener("keydown", handleInput, false);
	    function handleInput(e) {
		 var KeyCode = {LEFT: 37, UP: 38, RIGHT: 39, DOWN: 40};
		 var dir = null;
		 switch (e.keyCode) {
			case KeyCode.UP:
				dir = 'up';
				break;
			case KeyCode.LEFT:
				dir = 'left';
				break;
			case KeyCode.RIGHT:
				dir = 'right';
				break;
			case KeyCode.DOWN:
				dir = 'down';
				break;
		 }
		 if ( dir !== null) {
		    socket.emit('changedirection', { dir: dir });
		 }
        }
		</script>

	</body>
</html>